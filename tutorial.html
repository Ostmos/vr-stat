<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VR-Stat</title>
    
    <script src="https://cdn.rawgit.com/Ostmos/aframe/4c94b5d3/dist/aframe-master.min.js"></script>
    <script src="build/vr-stat.bundle.js"></script>
    
    <script>AFRAME.registerComponent('camera-listener', {
        tick: function () {
          //var cameraEl = this.el.sceneEl.camera.el;
          var cameraEl = document.querySelector('#rig');
          var circleEl = document.querySelector('#circle');

          var cameraPosZ = cameraEl.getAttribute('position').z;

          var textTele = document.querySelector('#txtTeleport');
          var controllerTeleport = document.querySelector('#modelTeleportController');
          
          var textMove = document.querySelector('#txtMove');
          var controllerMove = document.querySelector('#modelMoveController');
          var moveDiagram = document.querySelector('#move');

          var moveDiagramPosX = moveDiagram.getAttribute('position').x;
          var moveDiagramPosY = moveDiagram.getAttribute('position').y;
          var moveDiagramPosZ = moveDiagram.getAttribute('position').z;
          var moved;

          //Rotate components
          var textRotate = document.querySelector('#txtRotate');
          var controllerRotate = document.querySelector('#modelRotateController');
          var rotateDiagram = document.querySelector('#rotate');

          var rotateDiagramPosX = rotateDiagram.getAttribute('rotation').x;
          var rotateDiagramPosY = rotateDiagram.getAttribute('rotation').y;
          var rotateDiagramPosZ = rotateDiagram.getAttribute('rotation').z;

          //Hover components
          var textHover = document.querySelector('#txtHover');

          //Link componenet

          var linkMuseum = document.querySelector('#museumPortal');
          var linkNoRoom = document.querySelector('#openWorldPortal');


          // Scene 1
          if(cameraPosZ<-2){
            var cameraMoved = true;
          }

          if(cameraMoved){
              // circleEl.setAttribute('position', {x: -1, y: 0, z: -9.8});

              /* txtMove.parentNode.removeChild(txtMove); */
              circleEl.setAttribute('visible', false);
              textTele.setAttribute('visible', false);
              controllerTeleport.setAttribute('visible', false);

              textMove.setAttribute('visible', true);
              controllerMove.setAttribute('visible', true);
              moveDiagram.setAttribute('visible', true);

          }

          // Scene 2

          if(moveDiagramPosX!=3.1 || moveDiagramPosY!=0.5 || moveDiagramPosZ != -8){
            moved = true;
          }

          if(moved){
            circleEl.setAttribute('position', {x: 10, y: 0, z: -10});

            circleEl.setAttribute('visible', true);
            rotateDiagram.setAttribute('visible', true);
            controllerRotate.setAttribute('visible', true);
            textRotate.setAttribute('visible', true);
            textHover.setAttribute('visible',true);

          }

          // Scene 3

          if(rotateDiagramPosX!=0 || rotateDiagramPosY!=-45 || rotateDiagramPosZ!=0){
            var rotated = true;
          }
          

          if(rotated){
            circleEl.setAttribute('position', {x: 4.2, y: 0, z: -15});
            // textRotate.setAttribute('visible', false);
            // textHover.setAttribute('visible',false);

            linkMuseum.setAttribute('visible', true);
            linkNoRoom.setAttribute('visible', true);

          }
          
        }
    })
    </script>

    <!-- <script>
      AFRAME.registerComponent('portal', {
          init: function(){
              var linkEl = document.querySelector('a-link');
              linkEl.addEventListener('click', function (){
                linkEl.navigate('index.html');
              });
          }
      });
    </script> -->
</head>

<body>
    <a-scene stats > <!-- avatar-replayer="src: src/assets/recordings/rotation.json">-->
      <a-asset>
        <a-asset-item id="modelTestRoom" src="src/assets/models/tutorial_room.gltf"></a-asset-item>
        <a-asset-item id="modelCircle" src="src/assets/models/circle.gltf"></a-asset-item>
        
        <a-asset-item id="modelTeleport" src="src/assets/models/teleport_controller.gltf"></a-asset-item>
        <a-asset-item id="modelMove" src="src/assets/models/move_controller.gltf"></a-asset-item>
        <a-asset-item id="modelScale" src="src/assets/models/scale_controller.gltf"></a-asset-item>
        <a-asset-item id="modelHover" src="src/assets/models/hover_controller.gltf"></a-asset-item>
        <a-asset-item id="modelRotate" src="src/assets/models/rotate_controller.gltf"></a-asset-item>
  
        <img id="imgSky" src="src/assets/images/equi.png">
        <img id="imgBoard" src="src/assets/images/museum_board_white.png">
        <img id="imgTeleport" src="src/assets/images/teleport_text_white.png">
        <img id="imgMove" src="src/assets/images/move_text_white.png">
        <img id="imgHover" src="src/assets/images/hover_text_white.png">
        <img id="imgRotate" src="src/assets/images/rotate_text_white.png">
        <!-- <img id="imgPortal" src="src/assets/images/portal_text.png"> -->
        <img id="imgMuseum" src="src/assets/images/index360View.png">
        <img id="imgOpenWorld" src="src/assets/images/openworld360View.png">
      </a-asset>
  
      <!--World-->
      <!-- <a-entity id="modelTutorial" position="0 0 0" scale="1 1 1" gltf-model="#modelTestRoom" shadow></a-entity> -->
      <!-- <a-plane position="0 0 0" color="#0d194c" rotation="-90 0 0" scale="50 50 1" side="front"></a-plane> -->
      <a-entity geometry="primitive: plane; width:50; height:50" material="color:#1c2733; opacity: 0.5" scale="70 70 0" position="0 -1 0" rotation="-90 0 0"></a-entity>
      <a-entity id="circle" camera-listener visible="true" position="-0.5 0 -3.5" scale="0.5 0.5 0.5" gltf-model="#modelCircle"></a-entity>
      <!--<a-entity id="portal" link="href: index.html; title:Enter room; image: #imgBoard; color: black" visible="true" position="0 2 -2" scale="1 1 1"></a-entity>-->
      <a-link id="museumPortal" href="index.html" image="#imgMuseum" title="Right index finger to go to the Museum" visible="false" position="2.2 1.5 -20" scale="1 1 1" hoverable></a-link>
      <a-link id="openWorldPortal" href="open_world.html" image="#imgOpenWorld" title="Right index finger to the open space" visible="false" position="6.6 1.5 -20" scale="1 1 1" hoverable></a-link>
  
      <a-sky color="#212F3C"></a-sky>
  
      <!-- Light -->
      <a-entity light="type: ambient; color: #FFF; intensity:1"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="-0.5 20 -10" target="#target">
        <a-entity id="target" positon="4.2 0 -15"></a-entity>
      </a-entity>


      <!--Teleport-->
      <a-entity id="txtTeleport" position="0 1.7 -3" rotation="0 0 0" scale="0.5 0.5 0.5" visible="true">
        <a-image src="#imgTeleport" width="3" height="1" side="front"></a-image>
      </a-entity>
      <a-entity id="modelTeleportController" visible="true" rotation="-40 150 0" position="-0.5 1.2 -2.5" scale="0.003 0.003 0.003" gltf-model="#modelTeleport" camera-listener></a-entity>

      <!-- Move -->
      <a-entity id="txtMove" position="-0.4 1.7 -6" rotation="0 0 0" scale="0.5 0.5 0.5" visible="false"  camera-listener>
        <a-image src="#imgMove" width="3" height="1" side="front"></a-image>
      </a-entity>
     <!--  <a-entity id="move" class="cube rotate" visible="false" grabbable draggable bar-chart-listener position="3 1 -9" camera-listener bar-chart="yScale: 0.05; title: This is a diagram!; suffix: %; src:url(./src/assets/statistics/language_popularity.json)"></a-entity> -->
      <a-entity id="modelMoveController" visible="false" rotation="-10 150 0" position="0.4 1.2 -4.2" scale="0.003 0.003 0.003" gltf-model="#modelMove"  camera-listener></a-entity>
      <a-entity id="move"
                class="diagram" 
                bar-chart="yScale: 0.025; title: Move me!; suffix: %; src:url(./src/assets/statistics/tutorial-stats.json)" 
                position="3.1 0.5 -8"
                grabbable 
                draggable
                rotation-observer
                camera-listener
                visible="false"
                rotation="0 0 0"></a-entity>
      <!-- <a-entity id="move" class="cube rotate" visible="false" grabbable draggable bar-chart="title:I am a diagram!" bar-chart-listener position="3.5 0.5 -9" scale="1 1 1" rotation="0 270 0" camera-listener></a-entity> -->

      <!-- Rotate -->
      <!-- <a-entity id="rotate" class="cube rotate" visible="false" grabbable draggable bar-chart="title:Rotate me" bar-chart-listener scale="1 1 1" position="3.5 0.5 -14"  rotation="0 270 0" camera-listener></a-entity> -->      
      <a-entity id="rotate" 
        class="diagram" 
        bar-chart="yScale:0.025;title:Rotate me!;suffix:%;src:./src/assets/statistics/tutorial-stats.json" 
        position="15 0.5 -14" 
        grabbable 
        draggable
        rotation-observer
        camera-listener
        visible="false"
        rotation="0 -45 0"></a-entity>
      <a-entity id="txtRotate" position="10.655 2 -12" scale="0.5 0.5 0.5" camera-listener visible="false">
        <a-image src="#imgRotate" width="3" height="1" side="both"></a-image>
      </a-entity>
      <a-entity id="txtHover" position="10.655 1.5 -12" scale="0.5 0.5 0.5" camera-listener visible="false">
        <a-image src="#imgHover" width="3" height="0.5" side="both"></a-image>
      </a-entity>
      <a-entity id="modelRotateController" rotation="-30 170 0" position="11 1 -10.6" scale="0.003 0.003 0.003" gltf-model="src/assets/models/rotate_controller.gltf" camera-listener visible="false"></a-entity>
      <!-- <a-entity id="rotate" class="cube rotate" visible="false" grabbable draggable bar-chart-listener position="5 1 -16"  rotation="0 0 0" camera-listener bar-chart="yScale: 0.05; title: Programming language popularity; suffix: %; src:url(./src/assets/statistics/language_popularity.json)"></a-entity> -->
  
      <!-- Scale -->
      <!-- <a-entity id="scale" class="cube rotate" visible="false" grabbable draggable bar-chart="title:Scale me" bar-chart-listener scale="1 1 1" position="0.7 0.5 -21" camera-listener></a-entity>
      <a-entity id="modelScaleController" visible="false" rotation="-10 170 0" position=" 1.9 -19" scale="0.003 0.003 0.003" gltf-model="#modelScale" camera-listener></a-entity>
      <a-entity id="txtScale" position="1.3 2 -48" rotation="0 10 0" scale="1.9 1.9 1.9" visible="false"  camera-listener>
        <a-image src="#imgScale" width="3" height="1" side="front"></a-image>
      </a-entity> -->

      <!-- Correct controllers I think -->
      
        <a-entity id="rig" progressive-controls="objects: .diagram, a-link; maxLevel: point">
          <a-entity id="controller1" class="right-controller" 
            super-hands="grabEndButtons: triggerup; grabStartButtons: triggerdown; objects: .cube;"
            rotation-controller
            controller-display></a-entity>
          <a-entity id="controller2" class="left-controller" 
            teleport-controls="cameraRig:#rig; button: trigger; collisionEntities: #floor" 
            raycaster="showLine:false; enabled:false"></a-entity>
          <a-camera position="0 1.6 0"></a-camera>
        </a-entity>
     
    </a-scene>
    

</body>

</html>